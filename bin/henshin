#!/usr/bin/env ruby
#
# Usage:
#    henshin [options] [input] [output]
#    henshin help
#
$: << File.dirname(__FILE__) + '/../lib'

require 'henshin/cli'

module Henshin

  # Extend the command line interface with `new` command.
  class CLI

    EXAMPLES_DIR = Pathname.new(__FILE__).dirname + '..' + 'examples'

    desc 'Generate new files or sites'
    command :new do

      desc 'Create a new post for site in current directory'
      opt :post, :arg => "[<title>]", :default => 'New post' do
        post = <<EOS
---
title: #{title}
date: #{Time.now.strftime("%Y-%m-%d %H:%M")}
---

EOS
        f = File.new("posts/#{t}.md")
        f.puts(post)
        f.close
      end

      desc 'Create a new site in current directory'
      opt :site, :args => "[<name>]" do
        FileUtils.cp_r EXAMPLES_DIR + 'site', '.' || name
        exit
      end

      desc 'Create a new blog in current directory'
      opt :blog, :arg => "[<name>]" do |t|
        FileUtils.cp_r EXAMPLES_DIR + 'blog', '.' || name
        exit
      end

    end

  end
end

Henshin.parse!(ARGV)
